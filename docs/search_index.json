[["index.html", "Creating Interactive Maps of Census Data Using Leaflet and Tidycensus Preface Practice this process DataCamp Bookdown Options New Sentence, New Line RStudio Cloud Memory Use this for your CP", " Creating Interactive Maps of Census Data Using Leaflet and Tidycensus 2022-01-28 Preface This bookdown book provides examples of two skills you will need for the CP: Obtaining U.S. Census Data from the Census API via the tidycensus package Creating interactive maps using leaflet The skills used in this file (and that youll use for the CP) combine a lot of the skills youve learned in your BP. You havent used the Census API (or likely any API) or built interactive maps, but these are examples of the types of skills you should be capable of figuring out on your own using examples (such as the examples included in this book). Being able to figure out how to do new things like this is one of the key skills you should seek to develop in this course. Go through the examples carefully and make sure you understand them. This is usually best accomplished by modifying the examples and seeing if the changes you make are what appear in the output. For example, change the variable displayed in a map. Do this one little step at a time so that if there is an error, you know exactly which part didnt work. First, change the variable in the data used in the map. Then map it. Then modify the legend. Then modify the popups. Then try changing the color scale. With each little change you make, you dont venture too far from an example that already works. This makes it much easier to figure out whats not working when errors occur (and they willdont expect everything to work on your first try). If you try to make all these changes at once and it doesnt build, you often have a harder time figuring out which part(s) doesnt work. Practice this process This process is a great way to learn new skills on your own. Its likely a new experience for many students. Often people are used to doing exactly what they are told to for an assignment, and nothing else. But this type of skill-building on your own is a crucial skill in general for being successful on your own (e.g., at an internship or job, in grad school). Hopefully this process gives you confidence that you can do a lot more on your own than you might currently realize. DataCamp Note that there are DataCamp courses that go through use of the tidycensus and leaflet packages. You are free to go through those too (or any resources you find online). But going through what I included in this file should be sufficient (probably with some Googling of a few parts youre unsure about). There is no BP chapter required for this material. The CP should be enough incentive for you to want to learn how to use these skills. And including all this in the BP would slow it down considerably, so Ive left this as a separate book. (Although after the term is over, you might consider adding a version of this to your BP for future reference.) Bookdown Options Note that for this bookdown book, in the file _bookdown.yml the option is set to new_session: false. This means that when you build the book, it essentially puts all of the separate RMD files together into one long RMD file and knits it. This allows you to create R objects (e.g., dataframes) in an earlier RMD file and use them in later RMD files. That way you can create a data frame once and then use it in later RMD files. This is different from the BP where the option is set to new_session: true (or, actually, new_session: yestrue and yes are different in may situations, but in this case, they do the same thing). For the BP, each RMD is separate. This makes sense for the BP. If you create a mydata data frame in one chapter you dont want to accidentally use that same mydata in a different chapter. But for this example book, we want to use the same data throughout the book. It takes awhile to download and create the data, so we dont want to have to do it again on in each RMD file. But its nice to separate the content across multiple RMD files. This would facilitate collaboration if I was working on this with a group (such as you will be doing for the projects). It also makes each individual HTML file smaller, which works better with Git/GitHub. New Sentence, New Line Finally, look at the index.RMD file that creates this preface. Note the way the paragraphs are typed into the RMD file. Each sentence is on a new line, and each paragraph is started by having a blank line (I typically use 2 blank lines between paragraphs to make them easier to see, but 1 blank line is sufficient). This is how you should do your writing in RMD files (so, so this for the projects). It takes a little getting used to, but it has significant benefits. Git/GitHub does everything based on lines. When every sentence is its own line in the RMD file, you can see which sentences have been modified with each commit. This makes revision much easier. It also makes it easier to avoidmerge errors (when two people edit the same paragraph and then both try to commit and push), and to fix them when they do occur. RStudio Cloud Memory This file has a lot of maps that take up a fair amount of RAM. If you run the code chunks, that data and maps will take up a lot of RStudio Clouds RAM. If you then build the book, you might get an error (Ive gotten one that says: The previous R session was abnormally terminated due to an unexpected crash.). If you clear objects from the workspace (click on the broom icon on the Environment tab) before building, I dont think youll get an error. Use this for your CP For the CP you are free to copy code from this book as a starting point and modify it. So, the skills you learn will be directly useful for the CP, but also keep the bigger picture in mind too. "],["census-data-from-the-tidycensus-package.html", "1 Census Data from the Tidycensus Package 1.1 Figure out how to get multiple variables at one time", " 1 Census Data from the Tidycensus Package Were going to get most of the data from the US Census Bureau using the tidycensus package. Before going through the rest of this book, you should go through this brief tutorial on the tidycensus package: https://walker-data.com/tidycensus/articles/basic-usage.html Usually a few people ask about the Census API key. You need to request a Census API key from the link in the tutorial (you can use Lawrence University forOrganization Name). You need to do the census_api_key(\"YOUR API KEY GOES HERE\") part to store the API key. Dont put that code into your RMD file. You should run it once so that its stored in .Renviron and then not have to run it again. This page has a few more details that are often helpful: https://walker-data.com/tidycensus/reference/census_api_key.html. After you store it the first time, you either need to go to Session &gt; Restart R, or run readRenviron(\"~/.Renviron\") But dont put that into the codeyou dont want to re-load .Renviron every time. To be clear, going through that tutorial is how you learn to use the package. Work through it and make sure you can do their examples. Try making a few changes (e.g., request a different variable) and make sure it works. The function well use most is get_acs(). Go through the examples on that functions detailed description (https://walker-data.com/tidycensus/reference/get_acs.html). Try making a few changes to the provided example. For example, it creates a graph of median household income in Tarrant County, Texas. Try removing the part that specifies the county. You should see a map of all of Texas. Try changing the state to a different state (e.g., state = \"WI\" instead of state = \"TX\"). You can also try mapping a different variable (e.g., population instead of median household income). You could add a code chunk below to put together your examples. Then youll have them later if you need to figure something out again. 1.1 Figure out how to get multiple variables at one time For the CP you will need to get around 10 variables from the ACS. You should figure out how to use get_acs() to accomplish this. Experiment using c() to list the variables you want and give that list to the variables argument of get_acs(). You should also be able to re-name the variables something recognizable at the same time (their example includes variables = c(medincome = \"B19013_001\"), and you can do the same thing listing multiple variables, each with a human-readable name like medincome). Also check out the output = \"wide\" option. Figuring this out will make the CP much easier. Once you are able to get data from the Census Bureau using the tidycensus package, you are ready to move on. "],["create-dataset.html", "2 Create Dataset 2.1 GIS data download and preparation 2.2 Election data download and preparation 2.3 Popup labels", " 2 Create Dataset Now that you know how to use the tidycensus package download data from the US Census Bureau using the Census API, we are ready to put together the data we need to make an interactive map. 2.1 GIS data download and preparation First were going to download the geographic data we need to create maps. See the comments in the code below for explanations of what each part is doing. I kept it all together in one code chunk with comments to make it easier to re-use elsewhere (e.g., as part of your CP). library(tidyverse) library(leaflet) library(rmapshaper) library(tidycensus) options(tigris_use_cache = TRUE) ## turn off scientific notation options(scipen = 999) ## Download GIS data for maps ## geometry = TRUE --&gt; include GIS shapefile data to create maps ## B01001_001: total population ## NOTE: When you download the county data for the regressions, use options: geometry = False, keep_geo_vars = FALSE # Median household income countyGIS &lt;- get_acs(geography = &quot;county&quot;, variables = &quot;B01001_001&quot;, geometry = TRUE, keep_geo_vars = TRUE) # State data (for displaying state borders on map) stateGIS &lt;- get_acs(geography = &quot;state&quot;, variables = &quot;B01001_001&quot;, geometry = TRUE, keep_geo_vars = FALSE) ## Simplify GIS data to make file sizes smaller. This essentially removes some details along coastlines and very-not-straight borders. stateGIS &lt;- ms_simplify(stateGIS, keep = 0.01) countyGIS &lt;- ms_simplify(countyGIS, keep = 0.01) countyGIS &lt;- countyGIS %&gt;% select(FIPS = GEOID, stFIPS = STATEFP, coFIPS = COUNTYFP, coNAME = NAME.x, pop = estimate, geometry) ## For mapping, let&#39;s drop the following: ## Puerto Rico (ST FIPS 72) (no election data) ## Alaska (ST FIPS 02) (voting data isn&#39;t reported by county...we could also map the legislative districts, but we&#39;re not going to since we&#39;d rather have smaller maps without those extra details) ## Hawaii (ST FIPS 15) (so our map can zoom in on continental 48 states) countyGIS &lt;- countyGIS %&gt;% filter(stFIPS != &quot;72&quot; &amp; stFIPS != &quot;02&quot; &amp; stFIPS != &quot;15&quot;) stateGIS &lt;- stateGIS %&gt;% filter(GEOID != &quot;72&quot; &amp; GEOID != &quot;02&quot; &amp; GEOID != &quot;15&quot;) ## join 2-character state abbreviation and create name = &quot;county, St&quot; for labeling maps (e.g., Outagamie, WI) fipsToSTcode &lt;- fips_codes %&gt;% select(stFIPS = state_code, stNAME = state) %&gt;% unique() countyGIS &lt;- inner_join(countyGIS,fipsToSTcode,by=&quot;stFIPS&quot;) countyGIS &lt;- countyGIS %&gt;% mutate(name = paste0(coNAME,&quot;, &quot;, stNAME)) ## NOTE: If you don&#39;t use keep_geo_vars = TRUE, you don&#39;t get separate STATEFP and COUNTYFP, but you can use mutate() and create stFIPS = substr(GEOID,1,2) and coFIPS = substr(GEOID,3,5) 2.2 Election data download and preparation Now were going to download 2020 county-level election results from a GitHub repo. You can read more about the data in the repo. ## 2020 Election data dta2020 &lt;- read_csv(&quot;https://raw.githubusercontent.com/tonmcg/US_County_Level_Election_Results_08-20/master/2020_US_County_Level_Presidential_Results.csv&quot;) ## Calculate percentages based on total votes for Trump and Biden (GOP and Dem) only ## In some years there have been ties, so we&#39;re allowing for that ## stdVotes and stdVotesLog will be used to scale color opacity from 0 to 1 based on total votes dta2020 &lt;- dta2020 %&gt;% mutate(pctGOP = votes_gop/(votes_gop + votes_dem), totalVotes = votes_gop + votes_dem, winner = ifelse(dta2020$votes_gop &gt; dta2020$votes_dem,&quot;Trump&quot;, ifelse(dta2020$votes_gop &lt; dta2020$votes_dem,&quot;Biden&quot;, &quot;Tie&quot;)), pctWinner = ifelse(dta2020$votes_gop &gt; dta2020$votes_dem,pctGOP,1-pctGOP), FontColorWinner = ifelse(dta2020$votes_gop &gt; dta2020$votes_dem,&quot;red&quot;, ifelse(dta2020$votes_gop &lt; dta2020$votes_dem,&quot;blue&quot;, &quot;purple&quot;)), pctGOPcategories = ifelse(pctGOP&lt;0.48,&quot;0-48%&quot;, ifelse(pctGOP&lt;0.5,&quot;48-50%&quot;, ifelse(pctGOP&lt;0.52, &quot;50-52%&quot;, &quot;52-100%&quot;))), stdVotes = (totalVotes-min(totalVotes))/(max(totalVotes)-min(totalVotes)), stdVotesLog = (log(totalVotes)-min(log(totalVotes)))/(max(log(totalVotes))-min(log(totalVotes))) ) dta2020 &lt;- dta2020 %&gt;% select(FIPS = county_fips, pctGOP, totalVotes, winner, pctWinner, pctGOPcategories, FontColorWinner, stdVotes, stdVotesLog) ## merge GIS data with voting data using FIPS code countyGIS &lt;- left_join(countyGIS,dta2020,by=&quot;FIPS&quot;) countyGIS is what well use to make the maps, along with stateGIS to draw state borders When you want to make maps of other variables obtained from tidycensus, you can call tidycensus again (this time with geometry = FALSE, keep_geo_vars = FALSE) to obtain a new variables and then merge it onto countyGIS just like we merged the election data (dta2020) onto countyGIS above. &lt;span style=color: red; font-weight:bold&gt;Do NOT re-download the geo vars every time. If you download them every time, it will make the files get really big and slow. You might not be able to build at all, and probably wont be able to commit/push. 2.3 Popup labels We also need to make the text (with HTML for formatting) to use in popup labels for each county. First we create the text that will make up the labels, along with HTML formatting (e.g., &lt;b&gt; to make the county name bold, font color to make it red when Trump wins and blue when Biden wins). Then we pipe that to the HTML function from the htmltools package that turns our text into HTML code that leaflet can use to make popups in the map. popupLabels &lt;- paste0(&quot;&lt;b&gt;&quot;,countyGIS$name,&quot; (&quot;,countyGIS$FIPS,&quot;)&lt;/b&gt;&quot;, &quot;&lt;br&gt;&lt;font color=&#39;&quot;,countyGIS$FontColorWinner,&quot;&#39;&gt;&quot;,countyGIS$winner, &quot;: &quot;, format(countyGIS$pctWinner*100,digits=4, trim=TRUE), &quot;%&lt;/font&gt;&quot;, &quot;&lt;br&gt;Total votes: &quot;, format(countyGIS$totalVotes,big.mark=&quot;,&quot;, trim=TRUE) ) %&gt;% lapply(htmltools::HTML) Note that in this example, were creating the popup labels one time and well use them in each map (since all the maps show the same data, just using different color schemes). For the CP you will create several maps that show different variables. For that, you need to create new popup labels for each map. I suggest you try to make changes to the popup labels below and see what they look like in the map. Note that the parts in &lt;&gt; are HTML formatting. For example &lt;b&gt;text&lt;/b&gt; makes the word text bold (like this). You arent expected to already know any HTML. You are, however, expected to be able to look online and figure it out. (Remember, becoming confident figuring out new skills on your own is one of the main goals of the course.) Note that if when you create a map you get an error message similar to cannot coerce type closure to vector of type character, it might be a problem with your popup labels. "],["election-map-bins.html", "3 Election Map: Bins", " 3 Election Map: Bins On this page well build our first map interactive web-based map of geospatial data using Leaflet. You have most likely interacted with maps made with Leaflet when reading articles online or on the websites of businesses, non-profits, universities, and government agencies. After working through this book you should be able to make leaflet maps yourself (and youll need to for the CP). Leaflet was initially a javascript library used to include interactive maps on websites. The leaflet R package allows you to create Leaflet maps from R, combining the data-analytic capabilities of R with the ability to create maps communicating your analysis that can be put directly on websites. The data for this map, and all those that follow, was create in the Create Dataset chapter. ## create color palette used by map pal &lt;- colorBin(&quot;RdBu&quot;, countyGIS$pctGOP, n = 9, reverse=TRUE) leaflet(countyGIS, options = leafletOptions(crsClass = &quot;L.CRS.EPSG3857&quot;), width=&quot;100%&quot;) %&gt;% addPolygons(weight = 0.5, color = &quot;gray&quot;, opacity = 0.7, fillColor = ~pal(pctGOP), fillOpacity = 1, smoothFactor = 0.5, label = popupLabels, labelOptions = labelOptions(direction = &quot;auto&quot;)) %&gt;% addPolygons(data = stateGIS,fill = FALSE,color=&quot;black&quot;,weight = 1) %&gt;% addLegend(pal = pal,values = ~countyGIS$pctGOP, opacity = 0.7, title = &quot;% Trump&quot;,position = &quot;bottomright&quot;) When you first look at the code above, you likely have no idea what most parts of it do. Thats completely fineand expected. When I created my first leaflet map, I didnt know what most of the parts did either. I played around with it and looked online until I figured it out. It is now your turn to do the same. Remember part of the goal is to improve your ability to figure things out on your own. If you cant figure out new things on your own, then the skills you leave Lawrence with will be the only skills you use for the rest of your life. If thats the type of job you want, you probably dont actually want a liberal arts education. The rest of this file has versions of the map above that use different color schemes to display the same data. Spend some time thinking about how the different color schemes convey different messages, despite being base on the same data. "],["election-map-custom-bins.html", "4 Election Map: Custom Bins", " 4 Election Map: Custom Bins The first map used 10 equally-space bins. This map uses custom bins. ## You can also use custom bins pal &lt;- colorBin(&quot;RdBu&quot;, countyGIS$pctGOP,bins = c(0,0.2,0.3,.4,.45,.49,.51,.55,.6,0.7,0.8, 1), reverse=TRUE) leaflet(countyGIS, options = leafletOptions(crsClass = &quot;L.CRS.EPSG3857&quot;), width=&quot;100%&quot;) %&gt;% addPolygons(weight = 0.5, color = &quot;gray&quot;, opacity = 0.7, fillColor = ~pal(pctGOP), fillOpacity = 1, smoothFactor = 0.5, label = popupLabels, labelOptions = labelOptions(direction = &quot;auto&quot;)) %&gt;% addPolygons(data = stateGIS,fill = FALSE,color=&quot;black&quot;,weight = 1) %&gt;% addLegend(pal = pal,values = ~countyGIS$pctGOP, opacity = 0.7, title = &quot;% Trump&quot;,position = &quot;bottomright&quot;) "],["election-map-continuous-with-2-colors.html", "5 Election Map: Continuous with 2 Colors", " 5 Election Map: Continuous with 2 Colors Instead of bins you can use a continuous scale. The map below uses a continuous scale with 2 colors. The two colors, red and blue, become become purple in the middle where they mix. pal &lt;- colorNumeric( palette = colorRampPalette(c(&#39;red&#39;, &#39;blue&#39;))(length(countyGIS$pctGOP)), domain = countyGIS$pctGOP, reverse=TRUE) leaflet(countyGIS, options = leafletOptions(crsClass = &quot;L.CRS.EPSG3857&quot;), width=&quot;100%&quot;) %&gt;% addPolygons(weight = 0.5, color = &quot;gray&quot;, opacity = 0.7, fillColor = ~pal(pctGOP), fillOpacity = 1, smoothFactor = 0.5, label = popupLabels, labelOptions = labelOptions(direction = &quot;auto&quot;)) %&gt;% addPolygons(data = stateGIS,fill = FALSE,color=&quot;black&quot;,weight = 1) %&gt;% addLegend(pal = pal,values = ~countyGIS$pctGOP, opacity = 0.7, title = &quot;% Trump&quot;,position = &quot;bottomright&quot;) "],["election-map-continuous-with-3-colors.html", "6 Election Map: Continuous with 3 Colors", " 6 Election Map: Continuous with 3 Colors The previous map used a continuous scale with 2 colors, red and blue. This map uses 3 colors, adding white between the red and blue. pal &lt;- colorNumeric( palette = colorRampPalette(c(&#39;red&#39;, &#39;white&#39;, &#39;blue&#39;))(length(countyGIS$pctGOP)), domain = countyGIS$pctGOP, reverse=TRUE) leaflet(countyGIS, options = leafletOptions(crsClass = &quot;L.CRS.EPSG3857&quot;), width=&quot;100%&quot;) %&gt;% addPolygons(weight = 0.5, color = &quot;gray&quot;, opacity = 0.7, fillColor = ~pal(pctGOP), fillOpacity = 1, smoothFactor = 0.5, label = popupLabels, labelOptions = labelOptions(direction = &quot;auto&quot;)) %&gt;% addPolygons(data = stateGIS,fill = FALSE,color=&quot;black&quot;,weight = 1) %&gt;% addLegend(pal = pal,values = ~countyGIS$pctGOP, opacity = 0.7, title = &quot;% Trump&quot;,position = &quot;bottomright&quot;) "],["election-map-4-categories.html", "7 Election Map: 4 Categories", " 7 Election Map: 4 Categories This map uses 4 custom-labeled factors. This map is similar to what you often see on the news, displaying either red or blue. However, this one highlights close counties in slightly different colors. As you can see, there arent very many close counties (something thats impossible to see on a two-color map). pal &lt;- colorNumeric( palette = colorRampPalette(c(&#39;red&#39;, &#39;white&#39;, &#39;blue&#39;))(length(countyGIS$pctGOP)), domain = countyGIS$pctGOP, reverse=TRUE) factorPal &lt;- colorFactor(c(&quot;blue&quot;, &quot;cyan&quot;, &quot;magenta&quot;, &quot;red&quot;), countyGIS$pctGOPcategories ) leaflet(countyGIS, options = leafletOptions(crsClass = &quot;L.CRS.EPSG3857&quot;), width=&quot;100%&quot;) %&gt;% addPolygons(weight = 0.5, color = &quot;gray&quot;, opacity = 0.7, fillColor = ~factorPal(pctGOPcategories), fillOpacity = 1, smoothFactor = 0.5, label = popupLabels, labelOptions = labelOptions(direction = &quot;auto&quot;)) %&gt;% addPolygons(data = stateGIS,fill = FALSE,color=&quot;black&quot;,weight = 1) %&gt;% addLegend(pal = factorPal,values = ~countyGIS$pctGOPcategories, opacity = 0.7, title = &quot;% Trump&quot;,position = &quot;bottomright&quot;) What you see is a mostly red country with small pockets of blue and a few close counties. What you dont see in this map is anything about population. That is a significant limitation to this type of map. All counties seem to count equally when you look at the map. However, some counties have many times more people than other counties. The county with the most votes is Los Angeles, CA (total population 10,081,570, total votes 4,174,415). The county with the fewest votes is Loving, TX (total population 98, total votes 64). Land doesnt vote, people do is the phrase often associated by the bias created by this type of visualization. To get a better sense of this yourself, you can explore the data a bit more. Look at the smallest, say, 1000 counties and see how they voted. Compare that to the largest counties and see how they voted. If you start adding up the populations of the smallest counties, how many counties do you have to add up to reach the population of the single largest county? Look into a few of these things to get a better sense for the data, and thus for what is conveyed by these types of maps. This is not to say that these types of maps arent useful, but choosing a good color scheme is important, and difficult. Here is a specific challenge to test your skills, and get better intuition for how population is distributed in the US. Find the population of the largest county. Figure out how many of the smallest counties you have to add up to reach the population of the largest county (is it the 100 smallest, population-wise, counties, the smallest 500, 1000?). Then create a map that displays the largest county in one color and all the smallest counties it takes to add up to the same population in a different color. "],["election-map-4-categories-opacity-by-log-of-total-votes.html", "8 Election Map: 4 Categories Opacity by Log of Total Votes", " 8 Election Map: 4 Categories Opacity by Log of Total Votes The map on the previous page suffers from land doesnt vote, people do type bias. The map on this page attempts to correct for that bias by setting the opacity based on the total number of votes in that county. It uses a log scale because otherwise, you only see a few counties (LA, Chicago, a few others). A version that doesnt use a log scale is shown on the following page. ## Now use 4 custom-labeled factors, with opacity set based on total votes (re-scaled after log) pal &lt;- colorNumeric( palette = colorRampPalette(c(&#39;red&#39;, &#39;white&#39;, &#39;blue&#39;))(length(countyGIS$pctGOP)), domain = countyGIS$pctGOP, reverse=TRUE) factorPal &lt;- colorFactor(c(&quot;blue&quot;, &quot;cyan&quot;, &quot;magenta&quot;, &quot;red&quot;), countyGIS$pctGOPcategories ) leaflet(countyGIS, options = leafletOptions(crsClass = &quot;L.CRS.EPSG3857&quot;), width=&quot;100%&quot;) %&gt;% addPolygons(weight = 0.5, color = &quot;gray&quot;, opacity = 0.7, fillColor = ~factorPal(pctGOPcategories), fillOpacity = countyGIS$stdVotesLog, smoothFactor = 0.5, label = popupLabels, labelOptions = labelOptions(direction = &quot;auto&quot;)) %&gt;% addPolygons(data = stateGIS,fill = FALSE,color=&quot;black&quot;,weight = 1) %&gt;% addLegend(pal = factorPal,values = ~countyGIS$pctGOPcategories, opacity = 0.7, title = &quot;% Trump&quot;,position = &quot;bottomright&quot;) This map is similar to the previous map, except the opacity is scaled by the total number of votes, re-scaled to be between 0 and 1 after taking the log. This is similar to the Value-by-alpha map shown in this article. To give you a better sense of the population distribution in the US, the following page does not use a log scale (so extreme values are all you see), and the final page has a map of total votes (instead of vote percentage). "],["election-map-4-categories-opacity-by-total-votes.html", "9 Election Map: 4 Categories Opacity by Total Votes", " 9 Election Map: 4 Categories Opacity by Total Votes This is the same map as the previous page, except not taking the log of total votes. A few counties have significantly higher populations (and thus total votes). ## Now use 4 custom-labeled factors, with opacity set based on total votes (re-scaled without taking log) pal &lt;- colorNumeric( palette = colorRampPalette(c(&#39;red&#39;, &#39;white&#39;, &#39;blue&#39;))(length(countyGIS$pctGOP)), domain = countyGIS$pctGOP, reverse=TRUE) factorPal &lt;- colorFactor(c(&quot;blue&quot;, &quot;cyan&quot;, &quot;magenta&quot;, &quot;red&quot;), countyGIS$pctGOPcategories ) leaflet(countyGIS, options = leafletOptions(crsClass = &quot;L.CRS.EPSG3857&quot;), width=&quot;100%&quot;) %&gt;% addPolygons(weight = 0.5, color = &quot;gray&quot;, opacity = 0.7, fillColor = ~factorPal(pctGOPcategories), fillOpacity = countyGIS$stdVotes, smoothFactor = 0.5, label = popupLabels, labelOptions = labelOptions(direction = &quot;auto&quot;)) %&gt;% addPolygons(data = stateGIS,fill = FALSE,color=&quot;black&quot;,weight = 1) %&gt;% addLegend(pal = factorPal,values = ~countyGIS$pctGOPcategories, opacity = 0.7, title = &quot;% Trump&quot;,position = &quot;bottomright&quot;) "],["total-votes-map.html", "10 Total Votes Map", " 10 Total Votes Map This final map shows total votes to give you a better idea of how the population is distributed around the US (it would be good practice if you create a map that shows total population). This map also demonstrates a different type of color palette. ## Custom bins to show total votes pal &lt;- colorBin(c(&quot;white&quot;,&quot;yellow&quot;,&quot;cyan&quot;,&quot;green&quot;,&quot;purple&quot;,&quot;magenta&quot;), countyGIS$totalVotes,bins = c(min(countyGIS$totalVotes), 25000, 50000, 100000, 500000, 1000000, max(countyGIS$totalVotes))) leaflet(countyGIS, options = leafletOptions(crsClass = &quot;L.CRS.EPSG3857&quot;), width=&quot;100%&quot;) %&gt;% addPolygons(weight = 0.5, color = &quot;gray&quot;, opacity = 0.7, fillColor = ~pal(totalVotes), fillOpacity = 1, smoothFactor = 0.5, label = popupLabels, labelOptions = labelOptions(direction = &quot;auto&quot;)) %&gt;% addPolygons(data = stateGIS,fill = FALSE,color=&quot;black&quot;,weight = 1) %&gt;% addLegend(pal = pal,values = ~countyGIS$totalVotes, opacity = 0.7, title = &quot;Total Votes&quot;,position = &quot;bottomright&quot;) Look closely at the legend. The white color counties start with the minimum number of votes cast in a county (64) up to only 25,000; this is the vast majority of the country. This gives you an idea of how misleading the standard choropleth map can be. That said, these types of maps also convey a lot of information in a compact and interactive way. But when you create maps like these, you need to think carefully about the clarity of what youre conveying with your map. In addition to hopefully making that point, this bookdown book of maps also demonstrates how you can create maps for your projects. There are many other color palette you can use. You want to think carefully about what you use for your project. Dont just pick whatever you try first or think looks pretty. In general, its best to use the same scale for similar maps. People get used to looking at it and it makes it easier to understand. However, dont use the same scale for different maps for the same reason (people get used to it meaning one thing and then miss that the meaning has changed). So, you should give the design of your maps some careful thought. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
